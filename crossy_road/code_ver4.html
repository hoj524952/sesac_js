<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>길건너 친구들 - 검은 배경</title>
<style>
  body { margin: 0; background-color: #000; }
  canvas { display: block; margin: 0 auto; border: 3px solid #333; background: #000; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="600" height="800"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player;
let cars;
let gameOver;
let animationId;

// 게임 초기화
function initGame() {
  player = { x: 280, y: 750, size: 40, targetX: 280, targetY: 750, color: "#FFD700" }; // 노란색 플레이어
  cars = [];
  gameOver = false;
  if (animationId) cancelAnimationFrame(animationId);
  update();
}

// 키 입력
document.addEventListener("keydown", (e) => {
  if (gameOver) return;
  const step = 60;
  if (e.key === "ArrowUp") player.targetY -= step;
  if (e.key === "ArrowDown") player.targetY += step;
  if (e.key === "ArrowLeft") player.targetX -= step;
  if (e.key === "ArrowRight") player.targetX += step;

  // 화면 밖으로 안 나가게
  player.targetX = Math.max(0, Math.min(canvas.width - player.size, player.targetX));
  player.targetY = Math.max(0, Math.min(canvas.height - player.size, player.targetY));
});

// 자동차 생성
function spawnCar() {
  const lane = Math.floor(Math.random() * 6);
  const speed = 2 + Math.random() * 3;
  const carWidth = 80;
  const carHeight = 40;
  const colors = ["#FF4500", "#1E90FF", "#FF69B4"]; // 빨강, 파랑, 핑크
  const color = colors[Math.floor(Math.random() * colors.length)];
  cars.push({ x: -carWidth, y: lane * 120 + 60, width: carWidth, height: carHeight, speed, color });
}

// 플레이어 부드럽게 이동
function updatePlayer() {
  const lerpFactor = 0.2;
  player.x += (player.targetX - player.x) * lerpFactor;
  player.y += (player.targetY - player.y) * lerpFactor;
}

// 게임 루프
function update() {
  if (gameOver) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // 배경: 검은색 (이미 캔버스 기본색이 검정)
  ctx.fillStyle = "#000";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // 길과 풀 영역
  for (let i = 0; i < 6; i++) {
    ctx.fillStyle = i % 2 === 0 ? "#555" : "#888"; // 길: 짙은 회색, 풀: 밝은 회색
    ctx.fillRect(0, i * 120 + 40, canvas.width, 120);
  }

  // 자동차 이동
  for (let i = cars.length - 1; i >= 0; i--) {
    const car = cars[i];
    car.x += car.speed;
    ctx.fillStyle = car.color;
    ctx.beginPath();
    ctx.roundRect(car.x, car.y, car.width, car.height, 10);
    ctx.fill();

    // 충돌 체크
    if (
      player.x < car.x + car.width &&
      player.x + player.size > car.x &&
      player.y < car.y + car.height &&
      player.y + player.size > car.y
    ) {
      gameOver = true;
      setTimeout(() => {
        if (confirm("게임 오버! 다시 시작하시겠어요?")) {
          initGame();
        }
      }, 10);
    }

    if (car.x > canvas.width) cars.splice(i, 1);
  }

  // 플레이어 그리기 (둥근 캐릭터)
  updatePlayer();
  ctx.fillStyle = player.color;
  ctx.beginPath();
  ctx.arc(player.x + player.size / 2, player.y + player.size / 2, player.size / 2, 0, Math.PI * 2);
  ctx.fill();

  // 승리 조건
  if (player.y <= 20) {
    gameOver = true;
    setTimeout(() => {
      if (confirm("승리! 길을 다 건넜어요! 다시 시작하시겠어요?")) {
        initGame();
      }
    }, 10);
  }

  animationId = requestAnimationFrame(update);
}

// 자동차 생성 주기
setInterval(spawnCar, 1000);

// 게임 시작
initGame();
</script>
</body>
</html>
